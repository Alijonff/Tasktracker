# Логика работы системы Tasktracker

Этот документ описывает логику системы простым языком: кто что может делать, как работают роли, задачи, аукционы и баллы.

---
## 1. Роли и полномочия

### 1.1. Администратор

Админ — самый высокий уровень доступа.
Он может:
- создавать и удалять департаменты;
- назначать и менять директоров департаментов;
- повышать заместителя директора до директора;
- увольнять директоров департаментов;
- создавать и удалять любых сотрудников;
- править роли сотрудников;
- вмешиваться в любую часть структуры и исправлять конфликты.

### 1.2. Директор департамента

Директор управляет всем внутри своего департамента.
Он может:
- создавать и менять структуру департамента: управления и отделы;
- добавлять новых сотрудников в департамент и удалять их;
- назначать и менять должности внутри департамента (старший, руководитель отдела, зам руководителя и т.п.);
- создавать задачи и аукционы для департамента;
- увольнять любого сотрудника департамента, включая заместителя директора.

Он не может:
- увольнять самого себя (только админ);
- назначать кого-либо директором департамента (только админ).

### 1.3. Заместитель директора департамента

Зам директора имеет почти те же права, что и директор департамента.
Он может:
- менять структуру департамента (управления, отделы);
- добавлять и удалять сотрудников внутри департамента;
- назначать и менять должности сотрудников в департаменте;
- создавать задачи и аукционы;
- увольнять любых сотрудников департамента, **кроме директора**.

Он не может:
- уволить директора департамента;
- повысить кого-либо до директора департамента.

### 1.4. Руководители управлений и отделов, их заместители

Есть руководители управлений и отделов, а также их заместители.

В обычном случае, когда управление принадлежит департаменту:
- их главная особенность — более высокий грейд и стартовые баллы;
- они не могут:
  - менять структуру департамента;
  - увольнять сотрудников;
  - создавать задачи и аукционы от имени департамента.

Особый случай: **управление, созданное отдельно от департамента**.
- Такое управление работает как самостоятельная единица.
- Руководитель и заместитель такого управления получают права, похожие на директора:
  - могут создавать задачи и аукционы в рамках этого управления;
  - могут добавлять сотрудников в своё управление;
  - могут управлять внутренней структурой управления.

### 1.5. Обычные и старшие сотрудники

- Обычные сотрудники и старшие сотрудники:
  - могут заходить в систему;
  - видеть задачи и аукционы, доступные их грейду;
  - участвовать в аукционах и выполнять задачи;
  - получать и терять баллы.
- Они не могут менять структуру, назначать роли или увольнять других.

---
## 2. Грейды и стартовые баллы

У каждого сотрудника есть грейд и стартовые баллы:

- **Грейд A — 85 баллов**
  - Директор департамента;
  - Заместитель директора департамента;
  - Руководитель управления.

- **Грейд B — 70 баллов**
  - Заместитель руководителя управления;
  - Руководитель отдела.

- **Грейд C — 55 баллов**
  - Старший сотрудник.

- **Грейд D — 40 баллов**
  - Обычный сотрудник.

Правила:
- При назначении на должность сотрудник получает соответствующий грейд и стартовое количество баллов.
- При повышении или понижении в должности **количество накопленных баллов не меняется**, меняется только грейд.
- Баллы изменяются только автоматически по результатам задач. Вручную баллы менять нельзя никому.

---
## 3. Структура: департамент, управление, отдел

- **Департамент** — основная единица.
  - У департамента есть директор, заместитель директора, управления и отделы.

- **Управление** может быть двух типов:
  1. Управление внутри департамента — обычная часть структуры департамента.
  2. Управление, созданное отдельно (без департамента) — самостоятельная единица, где руководитель и зам управления работают как «директор» этого управления.

- **Отдел**:
  - может принадлежать управлению;
  - может быть отдельным отделом внутри департамента.

Структура должна быть логичной: отдел и управление не могут принадлежать разным департаментам одновременно.

---
## 4. Жизненный цикл задачи

Каждая задача проходит через четыре статуса:

1. **Бэклог**
   - Задача выставлена на аукцион.
   - Исполнитель ещё не выбран.
   - Сотрудники видят задачу и могут предлагать свои ставки.

2. **В работе**
   - Аукцион завершён, исполнитель выбран.
   - Задача закреплена за конкретным сотрудником.
   - Сотрудник выполняет задачу.

3. **На проверке**
   - Исполнитель отправил результат работы создателю задачи.
   - Создатель задачи проверяет качество выполнения.

4. **Завершен**
   - Создатель задачи принял результат.
   - Исполнителю начисляются баллы и сумма по результатам аукциона.

Переходы между статусами идут последовательно, без «прыжков».

---
## 5. Аукционы: кто создаёт и как работают

### 5.1. Кто может создавать аукционы

Задачи в формате аукциона могут создавать:
- директор департамента;
- заместитель директора департамента;
- руководитель или заместитель самостоятельного управления (которое не привязано к департаменту).

Создатель задачи может сам участвовать в своём аукционе как исполнитель, хотя это не рекомендуется.

### 5.2. Минимальный грейд

При создании аукциона задаётся минимальный грейд исполнителя.

- Задачу видят и могут брать в аукцион только сотрудники с грейдом **не ниже** указанного.
- Сотрудники с более низким грейдом эту задачу не видят и не могут ставить.

### 5.3. Ставки и выбор исполнителя

- Каждый участвующий сотрудник предлагает сумму, за которую он готов выполнить задачу.
- Нельзя предлагать сумму выше текущей лучшей (логика аукциона направлена на снижение стоимости).
- Один сотрудник может участвовать в неограниченном количестве аукционов одновременно.

По окончании аукциона (по умолчанию через 24 часа):

1. Побеждает тот, кто предложил **минимальную сумму**.
2. Если несколько сотрудников предложили одинаковую минимальную сумму:
   - побеждает тот, у кого **больше баллов** на момент окончания аукциона.
3. Если совпали и сумма, и баллы:
   - побеждает тот, кто сделал ставку **раньше**.

После выбора победителя задача переходит в статус «В работе» и закрепляется за выбранным исполнителем.

Создатель задачи не может вручную завершить аукцион раньше стандартного времени — он завершается по правилам системы.

---
## 6. Аукцион без ставок: рост цены и автоприсвоение

Если в течение аукциона **нет ни одной ставки**:

1. Стоимость задачи начинает плавно расти от исходного значения до **1.5× от начальной цены**.
   - Этот рост происходит в течение 24 часов с момента создания задачи.
   - Максимальное увеличение — 1.5 раза, выше цена не поднимается.

2. Если за эти 24 часа ни одна ставка так и не появилась:
   - цена достигает 1.5×;
   - ещё через примерно 3 часа аукцион автоматически закрывается;
   - задача автоматически назначается **создателю задачи**.

3. Создатель задачи обязан выполнить задачу:
   - при завершении ему начисляются баллы за выполнение;
   - ему зачисляется сумма по текущей цене задачи.

Если в аукционе есть хотя бы одна ставка, **рост цены не включается**.

---
## 7. Просрочка задач и штрафные баллы

Если задача находится в статусе «В работе» и исполнитель не успевает завершить её к дедлайну:

- Задача остаётся за этим исполнителем до завершения.
- За каждый **час просрочки в рабочее время** начисляется **штраф -1 балл**.
- Когда задача всё-таки доведена до статуса «Завершен», все накопленные штрафные баллы за эту задачу вычитаются из баллов сотрудника.

Если задача отправлена «На проверке» и возвращена на доработку:
- дополнительные штрафные баллы за возврат не начисляются автоматически;
- создатель задачи может оставить первоначальный дедлайн или продлить его — по своему усмотрению.

---
## 8. Проверка задачи и сроки проверки

Когда задача находится «На проверке»:

- Создатель задачи должен либо принять её (перевести в «Завершен»), либо вернуть в «В работе».
- На проверку отводится не более **двух рабочих дней**. Логика системы должна исключать зависание задач на проверке надолго.

---
## 9. Увольнение сотрудников и ставки

- Если сотрудник увольняется до выбора исполнителя:
  - все его активные ставки в аукционах аннулируются.

- Если сотрудник был исполнителем задачи в статусе «В работе» и его увольняют:
  - задача автоматически назначается создателю задачи.

---
## 10. Баллы: начисление и штрафы

Баллы нельзя менять вручную — ни директором, ни админом. Баллы полностью зависят от задач.

Принцип:
- задачи более высокого минимального грейда дают больше базовых баллов за успешное выполнение;
- за просрочку задач начисляются штрафные баллы (-1 за каждый час просрочки в рабочее время);
- при завершении задачи итоговые баллы за задачу равны: базовые за выполнение минус штрафы за просрочку.

Баллы — это рейтинг сотрудника, который влияет на исход аукционов при равных ставках.

